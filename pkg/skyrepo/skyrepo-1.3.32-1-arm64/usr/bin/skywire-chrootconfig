#!/bin/bash
##/usr/bin/skywire-chrootconfig
#called by the postinstall script of the skyrepo .deb package
#################################################################
#meant to run when the skyrepo package is installed in chroot
	if [[ $INSTALLFIRSTBOOT == "1" ]] ; then
		if [[ -f /etc/systemd/system/install-skywire.service ]] ; then
			systemctl enable install-skywire.service
		fi
	fi
	# create envfile
	if [[ ! -f /etc/profile.d/skyenv.sh && -d /etc/profile.d ]] ; then
		touch /etc/profile.d/skyenv.sh
	fi
	# SKYBIAN=true enables autostart of skywire via skywire-autoconfig - on ARM architectures
	if [[ $(cat /etc/profile.d/skyenv.sh | grep SKYBIAN ) != *"SKYBIAN"* ]] ; then
		if [[ $(dpkg --print-architecture) == *"amd64"* ]] ; then
			echo "#SKYBIAN=true" | tee -a /etc/profile.d/skyenv.sh
		else
			echo "SKYBIAN=true" | tee -a /etc/profile.d/skyenv.sh
		fi
	fi
	# VPNSERVER=1 enables autostart of the vpn server - on ARM architectures
	if [[ $(cat /etc/profile.d/skyenv.sh | grep VPNSERVER ) != *"VPNSERVER"* ]] ; then
		if [[ $(dpkg --print-architecture) == *"amd64"* ]] ; then
			echo "#export VPNSERVER=1" | tee -a /etc/profile.d/skyenv.sh
		else
			echo "export VPNSERVER=1" | tee -a /etc/profile.d/skyenv.sh
		fi
	fi

